<link rel="import" href="scritch007-dialog.html">

<polymer-element name="scritch007-share" constructor="ScritchShare" attributes="download_link chromecast_available flash_available">
<template>
	<scritch007-dialog heading="Download" transition="paper-dialog-transition-bottom" id="dialog" autoCloseDisabled="true">
        <style no-shim>
        .dialog {
          box-sizing: border-box;
          -moz-box-sizing: border-box;
          font-family: Arial, Helvetica, sans-serif;
          font-size: 13px;
          -webkit-user-select: none;
          -moz-user-select: none;
          overflow: hidden;
          background: white;
          padding:30px 42px;
          outline: 1px solid rgba(0,0,0,0.2);
          box-shadow: 0 4px 16px rgba(0,0,0,0.2);
        }

        #dialog {
          width: 500px;
        }
        paper-button[autofocus] {
          color: #4285f4;
        }
      </style>
    <div main id="dialog_main">
    <core-input type="text" value="{{ key }}" readonly></core-input>
    <template if="{{flash_available}}">
      <paper-icon-button icon="content-copy" id="copy_button" on-click="{{ copy }}"></paper-icon-button>
    </template>
    <paper-icon-button icon="file-download" on-click="{{ download }})"></paper-icon-button>
    <template if="{{ chromecast_available }}">
      <paper-icon-button icon="hardware:chromecast" on-click="{{ cast }}"></paper-icon-button>
    </template>
    </div>
		<paper-button id="close" label="Close" affirmative autofocus on-click="{{_close}}"></paper-button>
	</scritch007-dialog>
</template>
<script>
	Polymer("scritch007-share",{
    created: function(){
      this.loginCB = null;
      this.download_link = null;

    },
    ready: function(){
       //this.onMutation(this, this.childrenUpdated);
       //this.$.dialog.onMutation(this.$.dialog, this.childrenUpdated);
    },
    attached: function(){
      console.log("attached");
    },
    domReady: function(){
      console.log("domReady");
      this.client = new ZeroClipboard(this.$.dialog.querySelectorAll("paper-icon-button")[0]);
      this.client.on("ready", function(){
        this.client.setText(this.download_link);
      }.bind(this));
    },
    _close: function(){
      ZeroClipboard.destroy();
      this.$.dialog.close();
      this.parentNode.removeChild(this);
    },
		toggle: function(){
			this.$.dialog.toggle();
		},
    download: function(){
      window.open(this.download_link);
    },
    cast: function(){
      console.log("cast");
    },
    copy: function(){
      console.log("Copy");
    },
    setDownloadLink: function(dlink){
      this.download_link = dlink;
      console.log("copy this "+ this.download_link );
    }
	})
</script>
</polymer-element>